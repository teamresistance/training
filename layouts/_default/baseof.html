<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="{{ if .Description }}{{ .Description }}{{ else }}{{ .Site.Title }} - Programming training and challenges for robotics team members{{ end }}"
    />
    <meta
      name="keywords"
      content="robotics, programming, training, FRC, Team Resistance, swerve drive, PID tuning, pathfinding"
    />
    <title>{{ if not .IsHome }}{{ .Title }} | {{ end }}{{ .Site.Title }}</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    {{ partial "header.html" . }} {{ partial "sidebar.html" . }}

    <main class="main-content">
      <div class="content-wrapper">{{ block "main" . }}{{ end }}</div>
    </main>

    {{ partial "footer.html" . }}

    <script>
      function toggleMobileMenu() {
        const sidebar = document.getElementById("sidebar-nav");
        sidebar.classList.toggle("active");
      }

      document.addEventListener("click", function (event) {
        const sidebar = document.getElementById("sidebar-nav");
        const toggle = document.querySelector(".mobile-menu-toggle");

        if (
          window.innerWidth <= 1024 &&
          !sidebar.contains(event.target) &&
          !toggle.contains(event.target) &&
          sidebar.classList.contains("active")
        ) {
          sidebar.classList.remove("active");
        }
      });

      // Heading anchor link handling
      document.addEventListener("DOMContentLoaded", function () {
        const headingAnchors = document.querySelectorAll(".heading-anchor");

        headingAnchors.forEach((anchor) => {
          anchor.addEventListener("click", function (e) {
            e.preventDefault();
            const href = this.getAttribute("href");
            const targetId = href.substring(1);

            // Update URL without page reload
            const fullUrl = window.location.origin + window.location.pathname + href;
            history.pushState(null, "", href);

            // Copy full URL to clipboard
            navigator.clipboard
              .writeText(fullUrl)
              .then(() => {
                const icon = this.querySelector(".heading-anchor-icon");
                const originalText = icon.textContent;
                icon.textContent = "âœ“";
                setTimeout(() => {
                  icon.textContent = originalText;
                }, 1000);
              })
              .catch((err) => {
                console.error("Failed to copy URL to clipboard:", err);
              });

            // Scroll to the heading smoothly
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
              targetElement.scrollIntoView({
                behavior: "smooth",
              });
            }
          });
        });
      });
    </script>
  </body>
</html>
